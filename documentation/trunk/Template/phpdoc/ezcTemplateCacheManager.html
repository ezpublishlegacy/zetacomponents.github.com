<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html 
	xmlns="http://www.w3.org/1999/xhtml"
	xml:lang="en"
	lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<meta name="description" content="Apache Zeta Components - reusable set of high quality PHP components to fasten your development." />
	<meta name="keywords" content="" />
	<meta name="author" content="jerome" />
	<meta name="language" content="en" />
	<meta name="date" content="Sun, 10 Jul 2011 11:11:07 +0200" />
	<meta name="robots" content="all" />

	<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />
	<meta name="DC.title" content="ezcTemplateCacheManager.html" />
	<meta name="DC.creator" content="jerome" />
	<meta name="DC.date" content="Sun, 10 Jul 2011 11:11:07 +0200" />
	<meta name="DC.rights" content="Copyright" />

	<link rel="meta" href="/zetacomponents/documentation/trunk/Template/phpdoc/ezcTemplateCacheManager.rdf" />
	<link rel="icon" href="/zetacomponents/images/favicon.png" type="image/png" />

	<link rel="Stylesheet" type="text/css" href="/zetacomponents/styles/screen.css" media="screen" />
	<link rel="Stylesheet" type="text/css" href="/zetacomponents/styles/print.css" media="print" />


	<title>Apache Zeta Components - high quality PHP components</title>
</head>
<body>
<div id="wcv">
	<h1>
		<a id="header-png" href="/zetacomponents" title="Apache Zeta Components - high quality PHP components">
			Apache Zeta Components - high quality PHP components
		</a>
	</h1>

	<ul class="navigation">
<li >
	<a href="/zetacomponents/news.html" title="About">About</a>
	</li>
<li >
	<a href="/zetacomponents/community/index.html" title="Community">Community</a>
	</li>
<li class="requested">
	<a href="/zetacomponents/documentation/overview.html" title="Documentation">Documentation</a>
	</li>
<li >
	<a href="/zetacomponents/download/index.html" title="Download">Download</a>
	</li>
<li >
	<a href="/zetacomponents/support.html" title="Support">Support</a>
	</li>

</ul>
<ul class="subnavigation">
<li >
	<a href="/zetacomponents/documentation/overview.html" title="Overview">Overview</a>
	</li>
<li >
	<a href="/zetacomponents/documentation/install.html" title="Installation">Installation</a>
	</li>

</ul>

	<div class="content">
    <ul class="tabs">
    <li >
	<a href="/zetacomponents/documentation/trunk/Template/tutorial.html" title="Tutorial">Tutorial</a>
	</li>
<li class="requested">
	<a href="/zetacomponents/documentation/trunk/Template/phpdoc/classtrees.html" title="API">API</a>
	</li>
<li >
	<a href="/zetacomponents/documentation/trunk/Template/functions.html" title="Functions ">Functions </a>
	</li>
<li >
	<a href="/zetacomponents/documentation/trunk/Template/EBNF.html" title="EBNF ">EBNF </a>
	</li>

</ul>

		
  <div class="phpdoc">
    <h2>Apache Zeta Components Manual :: Docs For Class ezcTemplateCacheManager</h2>

              
              <h3>Template::ezcTemplateCacheManager</h3>
    
<a name="sec-description"></a>
<h3>Interface ezcTemplateCacheManager</h3>

<p>Interface for the class that implement a cache manager.</p><div><p>Implementing this interface gives the application using ezcTemplate the possibilities to:</p><p></p><ul><li>Mark cache files invalid based on certain criteria in your application.</li><li>Remove old cache files.</li><li>Keep track of the cache dependencies.</li></ul>  The user application and ezcTemplate call methods of the implemented interface. In this way  the application communicates with the Template component.<p>The CacheManager implementation of should be made available to the Template component.  Register the CacheManager implementation to the 'cacheManager' property in the TemplateConfiguration.</p><p>The next example shows how the cache manager 'MyCacheManager' is registered:</p><p></p><ol><li><div class="src-line">&#8192;<span class="src-var">$config&#8192;</span>=&#8192;<span class="src-id"><a href="ezcTemplateConfiguration.html">ezcTemplateConfiguration</a></span><span class="src-sym">::</span><a href="ezcTemplateConfiguration.html#methodgetInstance">getInstance</a><span class="src-sym">(</span><span class="src-sym">)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$config</span><span class="src-sym">-&gt;</span><span class="src-id">cacheManager&#8192;</span>=&#8192;<span class="src-key">new&#8192;</span><span class="src-id">MyCacheManager</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
</ol><p>The methods in this interface that are called only by ezcTemplate:</p><p></p><ul><li>startCaching:      A new or existing cache file is going to be (over)written.</li><li>stopCaching:       The cache file is created.</li><li>isValid:           The Template component request whether the given (parameter) cache file is valid.</li><li>includeTemplate:   A sub template is included.</li></ul>  Remaining methods from the interface are only called by the user application:<p></p><ul><li>register:  Register a value (eg. userID) that is related to the cache file currently created.</li><li>update:    A registered value is updated. This may indicate that a cache file is outdated.</li></ul><p>A typical cache creation process is as follows:</p><p></p><ol><li>The user application calls $t-&gt;process("my_template.ezt").</li></ol>  2. The template "my_template.ezt" uses {cache_template}. A custom function {fetch} retrieves     query results from the database and returns the results in one or an array of objects. The idea     behind this is that when the cache is enabled, the expensive {fetch} query will be omitted.<p>3. If a cache file exists for the requested template, the template component calls     CacheManager::isValid() to see whether the cache file is still correct. If the     cache file is still correct, it will execute it and return. Otherwise it will (over)write     the cache file.</p><p>4. When the cache file needs to be recreated, it calls CacheManager::startCaching() first.     The CacheManager is now informed that the operations in the user application originate from     the template that is creating the cache. For example, the operations performed on the database     are (indirectly) invoked, via a custom block or function, by the Template engine.</p><p>5. The application code that returns the requested data should also inform the Cache Manager via the     CacheManager::register() method. For example, the Custom Function {fetch} calls     CacheManager::register( "user", $userID ) for each requested user.</p><p>The CacheManager::register() method stores the values in the database and relates it to the cache file     currently in creation. When one of these values changes, the cache file would be outdated.</p><p>6. The CacheManager::includeTemplate() is called when another template is included. Relate the current     cache with the included template and store it (for example in the database). The     CacheManager::isValid() can then also outdate the cache when a sub template is modified.</p><p>7. The CacheManager::stopCaching() is called when the cache file is created.</p><p>8. The user application should call the CacheManager::update() method when a change in the database or     application may affect any of the caches.</p><p>Keeping track of the values used in the caches can probably best stored in a database. Using the  file system only is also possible but makes things more complicated. The documentation of each method in  this interface has also an example implementation. The examples rely on a MySQL database with at least  the following tables.</p><p>The table 'cache_files' has (at least) the following properties:  </p><ol><li><div class="src-line">&#8192;+---------------+------------------+------+-----+---------+----------------+</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">Field&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">Type&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">Null&#8192;</span>|&#8192;<span class="src-id">Key&#8192;</span>|&#8192;<span class="src-key">Default&#8192;</span>|&#8192;<span class="src-id">Extra&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|</div></li>
<li><div class="src-line">&#8192;+---------------+------------------+------+-----+---------+----------------+</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">id&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">int</span><span class="src-sym">(</span><span class="src-num">10</span><span class="src-sym">)&#8192;</span><span class="src-id">unsigned&#8192;</span>|&#8192;<span class="src-id">NO&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">PRI&#8192;</span>|&#8192;<span class="src-id">NULL&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">auto_increment&#8192;</span>|</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">cache&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">varchar</span><span class="src-sym">(</span><span class="src-num">255</span><span class="src-sym">)&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">NO&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">MUL&#8192;</span>|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">expired&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">tinyint</span><span class="src-sym">(</span><span class="src-num">4</span><span class="src-sym">)&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">NO&#8192;&#8192;&#8192;</span>|&#8192;&#8192;&#8192;&#8192;&#8192;|&#8192;<span class="src-num">0&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|</div></li>
<li><div class="src-line">&#8192;+---------------+------------------+------+-----+---------+----------------+</div></li>
</ol><p></p><ul><li>id: Is the unique cache ID</li><li>cache: The (relative) path to the cache file.</li><li>expired: Has the value 0 if the cache is valid, otherwise 1.</li></ul><p>The table 'cache_values' has the following properties:</p><p></p><ol><li><div class="src-line">&#8192;+-------------+------------------+------+-----+---------+-------+</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">Field&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">Type&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">Null&#8192;</span>|&#8192;<span class="src-id">Key&#8192;</span>|&#8192;<span class="src-key">Default&#8192;</span>|&#8192;<span class="src-id">Extra&#8192;</span>|</div></li>
<li><div class="src-line">&#8192;+-------------+------------------+------+-----+---------+-------+</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">cache_id&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">int</span><span class="src-sym">(</span><span class="src-num">10</span><span class="src-sym">)&#8192;</span><span class="src-id">unsigned&#8192;</span>|&#8192;<span class="src-id">NO&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">PRI&#8192;</span>|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">name&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">varchar</span><span class="src-sym">(</span><span class="src-num">50</span><span class="src-sym">)&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">NO&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">PRI&#8192;</span>|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|</div></li>
<li><div class="src-line">&#8192;|&#8192;<span class="src-id">value&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">varchar</span><span class="src-sym">(</span><span class="src-num">255</span><span class="src-sym">)&#8192;&#8192;&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">NO&#8192;&#8192;&#8192;</span>|&#8192;<span class="src-id">PRI&#8192;</span>|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;|</div></li>
<li><div class="src-line">&#8192;+-------------+------------------+------+-----+---------+-------+</div></li>
</ol><p></p><ul><li>cache_id: The relation to 'cache_files.id'.</li><li>name: Name of the value that is stored.</li><li>value: The value that belongs to the name. Name, value combination is up to user application.</li></ul><p>Another table can also store the cache keys that belong to the cache. The structure  of this table is similar to the 'cache_values' table.</p></div>
<p>Source for this file: <a href="http://fisheye6.atlassian.com/browse/zetacomponents/trunk/Template/src/interfaces/cache_manager.php?r=HEAD">/Template/src/interfaces/cache_manager.php</a></p>
       




  <table><tr><td>
            <strong>Version:</strong>&#8192;&#8192;
          </td>
          <td>//autogen//</td>
        </tr></table><a name="sec-method-summary"></a>
  <h3>Method Summary</h3>
  <table class="summary"><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#cleanExpired"><b>cleanExpired</b></a>(
               )
            </code>
            <br><div style="margin-left: 20px">The cleanExpired method should remove the expired caches.</div>          </td>
        </tr><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#includeTemplate"><b>includeTemplate</b></a>(
                                                                                    $template
                                                    ,                                     $templatePath
                                                 )
            </code>
            <br><div style="margin-left: 20px">This method is called by the template engine when another template is included.</div>          </td>
        </tr><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#isValid"><b>isValid</b></a>(
                                                                                    $template
                                                    ,                                     $templateName
                                                    ,                                     $cacheName
                                                 )
            </code>
            <br><div style="margin-left: 20px">The isValid method is called by ezcTemplate to verify whether the cache is valid.</div>          </td>
        </tr><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#register"><b>register</b></a>(
                                                                                    $name
                                                    ,                                     $value
                                                 )
            </code>
            <br><div style="margin-left: 20px">The user application should call this method to register values used in the current cache creation.</div>          </td>
        </tr><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#startCaching"><b>startCaching</b></a>(
                                                                                    $template
                                                    ,                                     $templatePath
                                                    ,                                     $cachePath
                                                    ,                                     $cacheKeys
                                                 )
            </code>
            <br><div style="margin-left: 20px">The template engine calls this method when a new cache file will be created.</div>          </td>
        </tr><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#stopCaching"><b>stopCaching</b></a>(
               )
            </code>
            <br><div style="margin-left: 20px">The stopCaching method is called by the Template Engine when the cache file is created.</div>          </td>
        </tr><tr><td class="right">
            <em>public</em>                        <em>void</em>          </td>
          <td>
            <code>
              <a href="#update"><b>update</b></a>(
                                                                                    $name
                                                    ,                                     $value
                                                 )
            </code>
            <br><div style="margin-left: 20px">The user application should call this method when the value changes that is previously registered with the register() method.</div>          </td>
        </tr></table><a name="sec-methods"></a>
  <h3>Methods</h3>
  <a name="method_detail"></a>
              
      <a name="methodcleanExpired" id="cleanExpired"><!-- --></a>

    <h4>cleanExpired</h4>

    <div class="method-signature">
      void
      cleanExpired(
      )
    </div>

    <p>The cleanExpired method should remove the expired caches.</p><div><p>The unused cache files on the hard-disk and the entries from the database tables:  cache_values and cache_files can be removed. This method should be called once  in a while to garantee that the system is not flooded with expired cache data.</p><p>An example implementation:  </p><ol><li><div class="src-line">&#8192;<span class="src-var">$db&#8192;</span>=&#8192;<span class="src-id"><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html">ezcDbInstance</a></span><span class="src-sym">::</span><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html#methodget">get</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(</span><span class="src-str">"SELECT&#8192;*&#8192;FROM&#8192;cache_templates&#8192;WHERE&#8192;expired&#8192;=&#8192;1"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$rows&#8192;</span>=&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">fetchAll</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-key">foreach&#8192;</span><span class="src-sym">(</span><span class="src-var">$rows&#8192;</span><span class="src-key">as&#8192;</span><span class="src-var">$r</span><span class="src-sym">)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<a href="http://www.php.net/unlink">unlink</a><span class="src-sym">(&#8192;</span><span class="src-var">$r</span><span class="src-sym">[</span><span class="src-str">"cache"</span><span class="src-sym">]&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">"DELETE&#8192;FROM&#8192;cache_values&#8192;USING&#8192;cache_values,&#8192;cache_templates&#8192;WHERE&#8192;cache_templates.id&#8192;=&#8192;cache_values.template_id&#8192;AND&#8192;cache_templates.expired&#8192;=&#8192;1&#8192;&#8192;"</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><a href="http://www.php.net/exec">exec</a><span class="src-sym">(</span><span class="src-str">"DELETE&#8192;FROM&#8192;cache_templates&#8192;WHERE&#8192;cache_templates.expired&#8192;=&#8192;1"</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
</ol></div>
    
        

    
    
    
        <a name="methodincludeTemplate" id="includeTemplate"><!-- --></a>

    <h4>includeTemplate</h4>

    <div class="method-signature">
      void
      includeTemplate(
                                  <a href="ezcTemplate.html">ezcTemplate</a>
          $template
                            ,           string
          $templatePath
                        )
    </div>

    <p>This method is called by the template engine when another template is included.</p><div><p>The implementation of this method should register the current included template. The following code  registers all the included templates and relates them to the cache file in creation.</p><p></p><ol><li><div class="src-line">&#8192;<span class="src-key">if&#8192;</span><span class="src-sym">(&#8192;</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">depth&#8192;</span>&gt;=&#8192;<span class="src-num">0&#8192;</span><span class="src-sym">)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$db&#8192;</span>=&#8192;<span class="src-id"><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html">ezcDbInstance</a></span><span class="src-sym">::</span><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html#methodget">get</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$id&#8192;</span>=&#8192;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">keys</span><span class="src-sym">[&#8192;</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">depth&#8192;</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">"cache_id"</span><span class="src-sym">]</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-comm">//&#8192;Insert&#8192;your&#8192;parent&#8192;template&#8192;in&#8192;the&#8192;value&#8192;table.</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(</span><span class="src-str">"REPLACE&#8192;INTO&#8192;cache_values&#8192;VALUES(:id,&#8192;:name,&#8192;:value)"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":id"</span><span class="src-sym">,&#8192;</span><span class="src-var">$id&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":name"</span><span class="src-sym">,&#8192;</span><span class="src-str">"include"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":value"</span><span class="src-sym">,&#8192;</span><span class="src-var">$templatePath&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
</ol></div>
          <h5>Parameters:</h5>
      <table class="detail"><thead><tr><th>Name</th>
            <th>Type</th>
            <th class="desc">Description</th>
          </tr></thead><tbody><tr><td><code>$template</code></td>
              <td><em><a href="ezcTemplate.html">ezcTemplate</a></em></td>
              <td>
                              </td>
            </tr><tr><td><code>$templatePath</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr></tbody></table><a name="methodisValid" id="isValid"><!-- --></a>

    <h4>isValid</h4>

    <div class="method-signature">
      void
      isValid(
                                  <a href="ezcTemplate.html">ezcTemplate</a>
          $template
                            ,           string
          $templateName
                            ,           string
          $cacheName
                        )
    </div>

    <p>The isValid method is called by ezcTemplate to verify whether the cache is valid.</p><div><p>The steps that could be implemented:</p><p></p><ol><li>Check if the current cache file is registered and if the cache file is expired.
    If the cache is not registered or the cache file is marked invalid, return false.</li></ol>  2. An extra step could be to check whether the current cache file is newer than all     included templates. The included templates are the templates included during     the creation of this cache file. The check ensures that the templates modified     by hand also renew the affected cache files. Usually, this step should only be     performed during development, because of the overhead.<p>The following code is an implementation of the steps above:  </p><ol><li><div class="src-line">&#8192;<span class="src-var">$db&#8192;</span>=&#8192;<span class="src-id"><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html">ezcDbInstance</a></span><span class="src-sym">::</span><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html#methodget">get</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;(1)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;Check&#8192;whether&#8192;the&#8192;cache&#8192;is&#8192;registered&#8192;and&#8192;if&#8192;it's&#8192;expired.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(</span><span class="src-str">"SELECT&#8192;id,&#8192;expired&#8192;FROM&#8192;cache_files&#8192;WHERE&#8192;cache&#8192;=&#8192;:cache"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":cache"</span><span class="src-sym">,&#8192;</span><span class="src-var">$cacheName&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-var">$r&#8192;</span>=&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">fetchAll</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;&#8192;</span><span class="src-comm">//&#8192;Expect&#8192;0&#8192;or&#8192;1&#8192;result</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-key">if&#8192;</span><span class="src-sym">(&#8192;</span><a href="http://www.php.net/count">count</a><span class="src-sym">(</span><span class="src-var">$r</span><span class="src-sym">)&#8192;</span>==&#8192;<span class="src-num">0&#8192;</span>||&#8192;<span class="src-var">$r</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">"expired"</span><span class="src-sym">]&#8192;</span>==&#8192;<span class="src-num">1&#8192;</span><span class="src-sym">)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-key">return&#8192;</span><span class="src-id">false</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;(2)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;Go&#8192;through&#8192;all&#8192;modification&#8192;times.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(&#8192;</span><span class="src-str">"SELECT&#8192;*&#8192;FROM&#8192;cache_values&#8192;WHERE&#8192;name&#8192;=&#8192;'include'&#8192;AND&#8192;cache_id&#8192;=&#8192;:id"</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":id"</span><span class="src-sym">,&#8192;</span><span class="src-var">$r</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">"id"</span><span class="src-sym">]&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-var">$r&#8192;</span>=&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">fetchAll</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-key">foreach&#8192;</span><span class="src-sym">(&#8192;</span><span class="src-var">$r&#8192;</span><span class="src-key">as&#8192;</span><span class="src-var">$a&#8192;</span><span class="src-sym">)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-key">if&#8192;</span><span class="src-sym">(&#8192;</span><a href="http://www.php.net/filemtime">filemtime</a><span class="src-sym">(&#8192;</span><span class="src-var">$a</span><span class="src-sym">[</span><span class="src-str">"value"</span><span class="src-sym">]&#8192;</span><span class="src-sym">)&#8192;</span>&gt;&#8192;<a href="http://www.php.net/filemtime">filemtime</a><span class="src-sym">(&#8192;</span><span class="src-var">$cacheName&#8192;</span><span class="src-sym">)&#8192;)</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-key">return&#8192;</span><span class="src-id">false</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-key">return&#8192;</span><span class="src-id">true</span><span class="src-sym">;</span></div></li>
</ol></div>
          <h5>Parameters:</h5>
      <table class="detail"><thead><tr><th>Name</th>
            <th>Type</th>
            <th class="desc">Description</th>
          </tr></thead><tbody><tr><td><code>$template</code></td>
              <td><em><a href="ezcTemplate.html">ezcTemplate</a></em></td>
              <td>
                              </td>
            </tr><tr><td><code>$templateName</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr><tr><td><code>$cacheName</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr></tbody></table><a name="methodregister" id="register"><!-- --></a>

    <h4>register</h4>

    <div class="method-signature">
      void
      register(
                                  string
          $name
                            ,           string
          $value
                        )
    </div>

    <p>The user application should call this method to register values used in the current cache creation.</p><div><p>Typically, the function that does a database query and returns the result set should also call the register() method.  The implementation of the register method should update the 'cache_values' table for all the cache_files on the stack.  See the next example code:</p><p></p><ol><li><div class="src-line">&#8192;<span class="src-var">$db&#8192;</span>=&#8192;<span class="src-id"><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html">ezcDbInstance</a></span><span class="src-sym">::</span><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html#methodget">get</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-key">for</span><span class="src-sym">(</span><span class="src-var">$i&#8192;</span>=&#8192;<span class="src-num">0</span><span class="src-sym">;&#8192;</span><span class="src-var">$i&#8192;</span>&lt;=&#8192;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">depth</span><span class="src-sym">;&#8192;</span><span class="src-var">$i</span>++<span class="src-sym">)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(&#8192;</span><span class="src-str">"REPLACE&#8192;INTO&#8192;cache_values&#8192;VALUES&#8192;(&#8192;:id,&#8192;:name,&#8192;:value&#8192;)"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":id"</span><span class="src-sym">,&#8192;</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">keys</span><span class="src-sym">[</span><span class="src-var">$i</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">"cache_id"</span><span class="src-sym">]&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":name"</span><span class="src-sym">,&#8192;</span><span class="src-var">$name&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":value"</span><span class="src-sym">,&#8192;</span><span class="src-var">$value&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
</ol><p>The member variables: $this-&gt;depth and $this-&gt;keys keep the amount of cache files and the cache file data that currently  created. Notice that the amount of cache files on the stack only increases with a 'template include' to another  cache file.</p><p>In the cache_values table maps a name, value to an ID. The update() method uses this information.</p></div>
          <h5>Parameters:</h5>
      <table class="detail"><thead><tr><th>Name</th>
            <th>Type</th>
            <th class="desc">Description</th>
          </tr></thead><tbody><tr><td><code>$name</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr><tr><td><code>$value</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr></tbody></table><a name="methodstartCaching" id="startCaching"><!-- --></a>

    <h4>startCaching</h4>

    <div class="method-signature">
      void
      startCaching(
                                  <a href="ezcTemplate.html">ezcTemplate</a>
          $template
                            ,           string
          $templatePath
                            ,           string
          $cachePath
                            ,           array(string=&gt;string)
          $cacheKeys
                        )
    </div>

    <p>The template engine calls this method when a new cache file will be created.</p><div><p>The $template parameter contains the Template object. This allows you to reach  the current template configuration, if needed.  The $templatePath is the (relative) path to the template currently creating the cache file.  The $cachePath is the (relative) path to the cache file.</p><p>$cacheKeys contains all cache keys used in the template (if any).</p><p>The startCaching method commonly performs the following steps, of course it's up to your application:</p><p></p><ol><li>Register the cache file in the cache_file table of the database. If the cache file is available set
    the expired status to 0. Otherwise add the cache to the table, with a new id and expired set to 0.</li></ol>  2. Push the current cache information: cacheKeys, templatePath, Template object on an internal stack. Other     CacheManager methods need this information.<p>3. Store the current template path in a database table that handles the included templates. The current     template includes 'itself'. This makes it easier to mark the this cache outdated.</p><p>The following code demonstrates the steps from above and uses the ezcSignalSlot component to send the  signals to the register method:</p><p></p><ol><li><div class="src-line">&#8192;<span class="src-comm">//&#8192;Get&#8192;the&#8192;current&#8192;database&#8192;handler.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$db&#8192;</span>=&#8192;<span class="src-id"><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html">ezcDbInstance</a></span><span class="src-sym">::</span><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html#methodget">get</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;(1)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;Get&#8192;the&#8192;current&#8192;cache&#8192;ID,&#8192;if&#8192;it&#8192;does&#8192;exist.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(</span><span class="src-str">"SELECT&#8192;id&#8192;FROM&#8192;cache_files&#8192;WHERE&#8192;cache&#8192;=&#8192;:cache"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":cache"</span><span class="src-sym">,&#8192;</span><span class="src-var">$cachePath&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;One&#8192;result&#8192;and&#8192;make&#8192;sure&#8192;the&#8192;query&#8192;is&#8192;terminated.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$r&#8192;</span>=&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">fetchAll</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-key">if&#8192;</span><span class="src-sym">(&#8192;</span><a href="http://www.php.net/sizeof">sizeof</a><span class="src-sym">(&#8192;</span><span class="src-var">$r&#8192;</span><span class="src-sym">)&#8192;</span>&gt;&#8192;<span class="src-num">0&#8192;</span><span class="src-sym">)&#8192;</span><span class="src-comm">//&#8192;Do&#8192;we&#8192;have&#8192;any&#8192;results?</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$id&#8192;</span>=&#8192;<span class="src-var">$r</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">[</span><span class="src-str">"id"</span><span class="src-sym">]</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-comm">//&#8192;Unexpire&#8192;the&#8192;cache_file.</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(&#8192;</span><span class="src-str">"UPDATE&#8192;cache_files&#8192;SET&#8192;expired=0&#8192;WHERE&#8192;id&#8192;=&#8192;:id"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":id"</span><span class="src-sym">,&#8192;</span><span class="src-var">$id&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&#8192;<span class="src-key">else</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-comm">//&#8192;Insert&#8192;the&#8192;new&#8192;cache&#8192;file</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(</span><span class="src-str">"INSERT&#8192;INTO&#8192;cache_files&#8192;VALUES(&#8192;'',&#8192;:cache,&#8192;'',&#8192;0)"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":cache"</span><span class="src-sym">,&#8192;</span><span class="src-var">$cachePath&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$id&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">lastInsertId</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-comm">//&#8192;(3)</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-comm">//&#8192;Insert&#8192;your&#8192;own&#8192;template&#8192;in&#8192;the&#8192;value&#8192;table.</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(</span><span class="src-str">"REPLACE&#8192;INTO&#8192;cache_values&#8192;VALUES(:id,&#8192;:name,&#8192;:value)"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":id"</span><span class="src-sym">,&#8192;</span><span class="src-var">$id&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":name"</span><span class="src-sym">,&#8192;</span><span class="src-str">"include"&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":value"</span><span class="src-sym">,&#8192;</span><span class="src-var">$templatePath&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-var">$q</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&#8192;</div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;(2)</span></div></li>
<li><div class="src-line">&#8192;<span class="src-comm">//&#8192;Depth&#8192;keeps&#8192;track&#8192;of&#8192;the&#8192;amount&#8192;of&#8192;caches&#8192;stored&#8192;on&#8192;the&#8192;stack.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">depth</span>++<span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<a href="http://www.php.net/array_push">array_push</a><span class="src-sym">(&#8192;</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">keys</span><span class="src-sym">,&#8192;</span><span class="src-key">array</span><span class="src-sym">(&#8192;</span><span class="src-str">"cache_path"&#8192;</span>=&gt;&#8192;<span class="src-var">$cachePath</span><span class="src-sym">,&#8192;</span><span class="src-str">"cache_id"&#8192;</span>=&gt;&#8192;<span class="src-var">$id</span><span class="src-sym">))</span><span class="src-sym">;</span></div></li>
</ol><p>The code above assumes that the private or protected member variables $depth and $keys  are available in the class.</p></div>
          <h5>Parameters:</h5>
      <table class="detail"><thead><tr><th>Name</th>
            <th>Type</th>
            <th class="desc">Description</th>
          </tr></thead><tbody><tr><td><code>$template</code></td>
              <td><em><a href="ezcTemplate.html">ezcTemplate</a></em></td>
              <td>
                              </td>
            </tr><tr><td><code>$templatePath</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr><tr><td><code>$cachePath</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr><tr><td><code>$cacheKeys</code></td>
              <td><em>array(string=&gt;string)</em></td>
              <td>
                              </td>
            </tr></tbody></table><a name="methodstopCaching" id="stopCaching"><!-- --></a>

    <h4>stopCaching</h4>

    <div class="method-signature">
      void
      stopCaching(
      )
    </div>

    <p>The stopCaching method is called by the Template Engine when the cache file is created.</p><div><p>The current cache information: cacheKeys, templatePath, Template object can be popped from the  internal stack. This is demonstrated in the following code:</p><p></p><ol><li><div class="src-line">&#8192;<span class="src-comm">//&#8192;Remove&#8192;the&#8192;current&#8192;template&#8192;cache&#8192;in&#8192;process.</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">depth</span>--<span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<a href="http://www.php.net/array_pop">array_pop</a><span class="src-sym">(&#8192;</span><span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">keys&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
</ol></div>
    
        

    
    
    
        <a name="methodupdate" id="update"><!-- --></a>

    <h4>update</h4>

    <div class="method-signature">
      void
      update(
                                  string
          $name
                            ,           string
          $value
                        )
    </div>

    <p>The user application should call this method when the value changes that is previously registered with the register() method.</p><div><p>Any name-value combination that is registered should be updated when the value changes. The cache file(s) using this name-value  are marked as expired.</p><p>The next example implementation expires all the cache files that uses the name-value:</p><p></p><ol><li><div class="src-line">&#8192;<span class="src-var">$db&#8192;</span>=&#8192;<span class="src-id"><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html">ezcDbInstance</a></span><span class="src-sym">::</span><a href="/zetacomponents/documentation/trunk/Database/phpdoc/ezcDbInstance.html#methodget">get</a><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$qry&#8192;</span>=&#8192;<span class="src-str">"UPDATE&#8192;cache_files,&#8192;cache_values&#8192;SET&#8192;cache_files.expired=1&#8192;"</span>.</div></li>
<li><div class="src-line">&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;&#8192;<span class="src-str">"WHERE&#8192;cache_files.id&#8192;=&#8192;cache_values.cache_id&#8192;AND&#8192;cache_values.name&#8192;=&#8192;:name&#8192;AND&#8192;cache_values.value&#8192;=&#8192;:value"</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$s&#8192;</span>=&#8192;<span class="src-var">$db</span><span class="src-sym">-&gt;</span><span class="src-id">prepare</span><span class="src-sym">(&#8192;</span><span class="src-var">$qry&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":name"</span><span class="src-sym">,&#8192;</span><span class="src-var">$name&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">bindValue</span><span class="src-sym">(&#8192;</span><span class="src-str">":value"</span><span class="src-sym">,&#8192;</span><span class="src-var">$value&#8192;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&#8192;<span class="src-var">$s</span><span class="src-sym">-&gt;</span><span class="src-id">execute</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
</ol></div>
          <h5>Parameters:</h5>
      <table class="detail"><thead><tr><th>Name</th>
            <th>Type</th>
            <th class="desc">Description</th>
          </tr></thead><tbody><tr><td><code>$name</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr><tr><td><code>$value</code></td>
              <td><em>string</em></td>
              <td>
                              </td>
            </tr></tbody></table><div class="credit">
      Documentation generated by <a href="http://www.phpdoc.org">phpDocumentor 1.4.3</a>
    </div>
  </div>
  
	</div>

	<div class="footer">
	Copyright © 2010 <a href="http://apache.org">The Apache Software Foundation</a>
</div>
</div>
</body>
</html>
